[domain/<%= scope['ipa::domain'] %>]
debug_level = <%= scope['ipa::sssd_debug_level'] %>
cache_credentials = True
krb5_store_password_if_offline = True
ipa_domain = <%= scope['ipa::domain'] %>
id_provider = ipa
auth_provider = ipa
access_provider = ipa
ipa_hostname = <%= @fqdn %>
chpass_provider = ipa
<% if (scope['ipa::ipa_role'] == 'master') or (scope['ipa::ipa_role'] == 'replica') -%>
# on masters/replicas, set ipa_server to itself to avoid this bug: https://access.redhat.com/solutions/3178971
ipa_server = <%= @fqdn %>
ipa_server_mode = True
<% elsif scope['ipa::ipa_role'] == 'client' -%>
ipa_server = _srv_, <%= scope['ipa::ipa_master_fqdn'] %>
<% end -%>
ldap_tls_cacert = /etc/ipa/ca.crt
<% if scope['ipa::install_autofs'] == true -%>
autofs_provider = ipa
ipa_automount_location = <%= scope['ipa::automount_location'] %>
<% end -%>
<% if scope['ipa::ignore_group_members'] == true -%>
ignore_group_members = True
subdomain_inherit = ldap_user_principal, ignore_group_members
<% else -%>
subdomain_inherit = ldap_user_principal
<% end -%>
ldap_user_principal = nosuchattr

<% if scope['ipa::ad_domain'] != '' -%>
[domain/<%= scope['ipa::domain'] -%>/<%= scope['ipa::ad_domain'] %>]
  <%- if scope['ipa::ad_site'] != '' -%>
ad_site = <%= scope['ipa::ad_site'] %>
  <%- end -%>
  <%- if scope['ipa::ad_ldap_search_base'] != '' -%>
ldap_search_base = <%= scope['ipa::ad_ldap_search_base'] %>
  <%- end -%>
<% end -%>

[sssd]
debug_level = <%= scope['ipa::sssd_debug_level'] %>
services = <%= scope['ipa::sssd_services'].join(',') %>
domains = <%= scope['ipa::domain'] %>

[nss]
debug_level = <%= scope['ipa::sssd_debug_level'] %>
homedir_substring = /home
<% if scope['ipa::override_homedir'] != nil -%>
override_homedir = <%= scope['ipa::override_homedir'] %>
<% end -%>
default_shell = /bin/bash
<% if (scope['ipa::ipa_role'] == 'master') or (scope['ipa::ipa_role'] == 'replica') -%>
memcache_timeout = 300
<% end -%>

[pam]
debug_level = <%= scope['ipa::sssd_debug_level'] %>

[sudo]
debug_level = <%= scope['ipa::sssd_debug_level'] %>

[autofs]
debug_level = <%= scope['ipa::sssd_debug_level'] %>

[ssh]
debug_level = <%= scope['ipa::sssd_debug_level'] %>

[pac]
debug_level = <%= scope['ipa::sssd_debug_level'] %>

[ifp]
debug_level = <%= scope['ipa::sssd_debug_level'] %>

<% if (scope['ipa::ipa_role'] == 'master') or (scope['ipa::ipa_role'] == 'replica') -%>
[secrets]
debug_level = <%= scope['ipa::sssd_debug_level'] %>

[session_recording]
<% end -%>

